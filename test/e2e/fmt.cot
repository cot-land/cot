import "std/fmt"
import "std/string"

// ============================================================================
// ANSI Colors
// ============================================================================

test "red wraps with ANSI codes" {
    var s = red("hello")
    @assertEq(s, "\x1b[31mhello\x1b[0m")
}

test "green wraps with ANSI codes" {
    var s = green("hello")
    @assertEq(s, "\x1b[32mhello\x1b[0m")
}

test "yellow wraps with ANSI codes" {
    var s = yellow("hello")
    @assertEq(s, "\x1b[33mhello\x1b[0m")
}

test "blue wraps with ANSI codes" {
    var s = blue("hello")
    @assertEq(s, "\x1b[34mhello\x1b[0m")
}

test "magenta wraps with ANSI codes" {
    var s = magenta("hello")
    @assertEq(s, "\x1b[35mhello\x1b[0m")
}

test "cyan wraps with ANSI codes" {
    var s = cyan("hello")
    @assertEq(s, "\x1b[36mhello\x1b[0m")
}

test "gray wraps with ANSI codes" {
    var s = gray("hello")
    @assertEq(s, "\x1b[90mhello\x1b[0m")
}

// ============================================================================
// Text Styles
// ============================================================================

test "bold wraps with ANSI codes" {
    var s = bold("hello")
    @assertEq(s, "\x1b[1mhello\x1b[0m")
}

test "dim wraps with ANSI codes" {
    var s = dim("hello")
    @assertEq(s, "\x1b[2mhello\x1b[0m")
}

test "italic wraps with ANSI codes" {
    var s = italic("hello")
    @assertEq(s, "\x1b[3mhello\x1b[0m")
}

test "underline wraps with ANSI codes" {
    var s = underline("hello")
    @assertEq(s, "\x1b[4mhello\x1b[0m")
}

test "strikethrough wraps with ANSI codes" {
    var s = strikethrough("hello")
    @assertEq(s, "\x1b[9mhello\x1b[0m")
}

// ============================================================================
// stripAnsi
// ============================================================================

test "stripAnsi removes color codes" {
    var s = red("hello")
    @assertEq(stripAnsi(s), "hello")
}

test "stripAnsi no-op on plain string" {
    @assertEq(stripAnsi("plain"), "plain")
}

test "stripAnsi multiple codes" {
    var s = bold(red("error"))
    @assertEq(stripAnsi(s), "error")
}

// ============================================================================
// Byte Formatting
// ============================================================================

test "formatBytes zero" {
    @assertEq(formatBytes(0), "0 B")
}

test "formatBytes bytes" {
    @assertEq(formatBytes(100), "100 B")
}

test "formatBytes KB" {
    @assertEq(formatBytes(1024), "1.0 KB")
}

test "formatBytes MB" {
    @assertEq(formatBytes(1048576), "1.0 MB")
}

test "formatBytes GB" {
    @assertEq(formatBytes(1073741824), "1.0 GB")
}

test "formatBytes fractional KB" {
    @assertEq(formatBytes(1536), "1.5 KB")
}

// ============================================================================
// Duration Formatting
// ============================================================================

test "formatDuration nanoseconds" {
    @assertEq(formatDuration(500), "500ns")
}

test "formatDuration microseconds" {
    @assertEq(formatDuration(1500), "1.5us")
}

test "formatDuration milliseconds" {
    @assertEq(formatDuration(1500000), "1.5ms")
}

test "formatDuration seconds" {
    @assertEq(formatDuration(1500000000), "1.5s")
}

test "formatDuration exact ms" {
    @assertEq(formatDuration(2000000), "2ms")
}

// ============================================================================
// Padding
// ============================================================================

test "padRight adds spaces" {
    @assertEq(padRight("hi", 5), "hi   ")
}

test "padRight no-op when long enough" {
    @assertEq(padRight("hello", 3), "hello")
}

test "padLeft adds spaces" {
    @assertEq(padLeft("42", 5), "   42")
}

test "padLeft no-op when long enough" {
    @assertEq(padLeft("hello", 3), "hello")
}

test "center pads both sides" {
    @assertEq(center("hi", 6), "  hi  ")
}

// ============================================================================
// Number Formatting
// ============================================================================

test "zeroPad adds leading zeros" {
    @assertEq(zeroPad(5, 3), "005")
}

test "zeroPad no-op when wide enough" {
    @assertEq(zeroPad(42, 2), "42")
}

test "hex decimal to hex" {
    @assertEq(hex(255), "ff")
}

test "hex zero" {
    @assertEq(hex(0), "0")
}

test "hex large number" {
    @assertEq(hex(65535), "ffff")
}

// ============================================================================
// Binary Formatting
// ============================================================================

test "binary zero" {
    @assertEq(binary(0), "0")
}

test "binary small" {
    @assertEq(binary(5), "101")
}

test "binary byte" {
    @assertEq(binary(255), "11111111")
}

test "binary 42" {
    @assertEq(binary(42), "101010")
}

// ============================================================================
// Octal Formatting
// ============================================================================

test "octal zero" {
    @assertEq(octal(0), "0")
}

test "octal 8" {
    @assertEq(octal(8), "10")
}

test "octal 255" {
    @assertEq(octal(255), "377")
}

test "octal 64" {
    @assertEq(octal(64), "100")
}

// ============================================================================
// Generic Base Formatting
// ============================================================================

test "formatInt base 2" {
    @assertEq(formatInt(10, 2), "1010")
}

test "formatInt base 16" {
    @assertEq(formatInt(255, 16), "ff")
}

test "formatInt base 8" {
    @assertEq(formatInt(8, 8), "10")
}
